<% content_for :page_title, "Submissions" %>
<% content_for :actions do %>
  <%= link_to "New", new_submission_path,
    class: 'btn btn-sm btn-outline-primary' %>
<% end %>

<table class="table">
  <thead>
    <tr>
      <th><%= Submission.human_attribute_name(:project_name) %></th>
      <th><%= Submission.human_attribute_name(:url) %></th>
      <th>Submitter</th>
      <th># Votes</th>
      <th>Actions</th>
      <th>Vote!</th>
    </tr>
  </thead>

  <tbody>
    <% @submissions.each do |submission| %>
      <tr>
        <td>
          <%= submission.project_name[0, 250] %>
          <% if current_user.voted_for?(submission) %>
            <span title="You voted for this!">
              <span data-feather="star" class="text-primary" title="You voted for this"></span>
            </span>
          <% end %>
        </td>
        <td><%= link_to submission.url, submission.url, target: "_blank" %></td>
        <td>
          <%= submission.team ? link_to(submission.team.name, submission.team) : link_to(submission.user.display_name, submission.user) %>
        </td>
        <td><%= submission.votes_count %></td>
        <td>
          <%= link_to "Show", submission %>
          <% if submission.user == current_user %>
            <%= link_to "Destroy", submission, method: :delete, data: { confirm: I18n.t('views.actions.confirm_destroy') } %>
          <% end %>
        </td>
        <td>
          <% if current_user.can_vote_for?(submission) %>
            <%= form_with(model: [submission, Vote.new], local: true) do |form| %>
              <%= button_tag class: "btn text-success d-inline", title: "Vote!" do %>
                <span data-feather="star"></span>
              <% end %>
            <% end %>
          <% elsif current_user.voted_for?(submission) %>
            <%= form_with(model: [submission, current_user.votes.where(submission_id: submission.id).first], local: true, method: :delete) do |form| %>
              <%= button_tag class: "btn text-danger", title: "Delete vote" do %>
                <span data-feather="trash"></span>
              <% end %>
            <% end %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
