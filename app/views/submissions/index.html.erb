<% content_for :page_title, Submission.model_name.human(count: 2) %>
<% content_for :actions do %>
  <%= link_to "New", new_submission_path,
    class: 'btn btn-sm btn-outline-primary' %>
<% end %>

<table class="table">
  <thead>
    <tr>
      <th><%= Submission.human_attribute_name(:project_name) %></th>
      <th><%= Submission.human_attribute_name(:url) %></th>
      <th><%= Submission.human_attribute_name(:user_id) %></th>
      <th>Votes</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody>
    <% @submissions.each do |submission| %>
      <tr>
        <td><%= submission.project_name %></td>
        <td><%= submission.url %></td>
        <td><%= link_to submission.user.name, submission.user %></td>
        <td><%= submission.votes_count %></td>
        <td>
          <% if current_user.can_vote_for?(submission) %>
            <%= form_with(model: [submission, Vote.new], local: true) do |form| %>
              <%= form.submit "Vote!" %>
            <% end %>
          <% elsif current_user.voted_for?(submission) %>
            You voted!
            <%= form_with(model: [submission, current_user.votes.where(submission_id: submission.id).first], local: true, method: :delete) do |form| %>
              <%= form.submit "Delete vote!" %>
            <% end %>
          <% end %>
          <% if current_user.admin? %>
            <%= link_to "Show", submission %>
          <% end %>
          <% if submission.user == current_user %>
            <%= link_to "Destroy", submission, method: :delete, data: { confirm: I18n.t('views.actions.confirm_destroy') } %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
